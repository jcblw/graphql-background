(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{85:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return a})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return u}));var r=n(3),i=n(7),o=(n(0),n(92)),a={id:"client-setup",title:"Client Setup",sidebar_label:"Setup client scripts"},s={unversionedId:"client-setup",id:"client-setup",isDocsHomePage:!1,title:"Client Setup",description:"The client represents content, popover or any of the other page scripts that are created internally in the extension. These scripts have a relatively small amount of setup needed because they are already connected with the background script. To install run npm install @finch-graphql/client --save.",source:"@site/docs/client-script-setup.md",sourceDirName:".",slug:"/client-setup",permalink:"/finch-graphql/docs/client-setup",editUrl:"https://github.com/jointoucan/finch-graphql/edit/master/packages/finch-docs/docs/client-script-setup.md",version:"current",sidebar_label:"Setup client scripts",frontMatter:{id:"client-setup",title:"Client Setup",sidebar_label:"Setup client scripts"},sidebar:"someSidebar",previous:{title:"Advanced API usage",permalink:"/finch-graphql/docs/advanced-api-usage"},next:{title:"Website Setup",permalink:"/finch-graphql/docs/website-setup"}},c=[{value:"Configuring your client",id:"configuring-your-client",children:[]},{value:"Querying information",id:"querying-information",children:[{value:"Custom message keys",id:"custom-message-keys",children:[]},{value:"Caching",id:"caching",children:[]}]},{value:"React Hooks",id:"react-hooks",children:[{value:"FinchProvider",id:"finchprovider",children:[]},{value:"useQuery",id:"usequery",children:[]},{value:"useMutation",id:"usemutation",children:[]}]}],l={toc:c};function u(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"The client represents content, popover or any of the other page scripts that are created internally in the extension. These scripts have a relatively small amount of setup needed because they are already connected with the background script. To install run ",Object(o.b)("inlineCode",{parentName:"p"},"npm install @finch-graphql/client --save"),"."),Object(o.b)("h2",{id:"configuring-your-client"},"Configuring your client"),Object(o.b)("p",null,"Finch GraphQL has a FinchClient class that is the client version of the FinchApi class. This allows you to configure your client to include things like custom message keys and caching."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-typescript"},"import { FinchClient, QueryCache } from '@finch-graphql/client';\n\nconst cache = new QueryCache();\n// Cache is optional\nexport const client = new FinchClient({ cache });\n")),Object(o.b)("h2",{id:"querying-information"},"Querying information"),Object(o.b)("p",null,"To be able to get information from the background script you would need to write a GraphQL query, and then use the ",Object(o.b)("strong",{parentName:"p"},"client")," method to pull that information from the GraphQL API."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-typescript"},"import { client } from './finch-client';\nimport gql from 'graphql-tag';\n\nconst GetBrowserPermissionDoc = gql`\n  query getBrowserPermission($input: PermissionsInput) {\n    browser {\n      permissions(input: $input)\n    }\n  }\n`;\n\n(async function main() {\n  const resp = await client.query(GetBrowserPermissionDoc, {\n    input: { permissions: ['geolocation'] },\n  });\n\n  if (resp.data?.browser?.permissions) {\n    // Do stuff with permissions\n  }\n})();\n")),Object(o.b)("p",null,"There is also a very similar method that will allow you to make mutations against the background API as well."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-typescript"},"await client.mutate(RequestPermissionDoc, {\n  input: { permissions: ['geolocation'] },\n});\n")),Object(o.b)("p",null,"In the above example we are asking the background process if the extension has the permission of ",Object(o.b)("strong",{parentName:"p"},"geolocation")," available to the extension. The we are able to check the response of the query to see if that permission is available. There is little to no setup here."),Object(o.b)("h3",{id:"custom-message-keys"},"Custom message keys"),Object(o.b)("p",null,"If you have a custom message key in your API then you can pass it to the constructor of the client."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-typescript"},"new FinchClient({\n  messageKey: 'secret',\n});\n")),Object(o.b)("h3",{id:"caching"},"Caching"),Object(o.b)("p",null,"Mentioned in setup of the client you can pass a instance of ",Object(o.b)("strong",{parentName:"p"},"QueryCache")," to the FinchClient. This will allow you to keep queries up to date across the codebase by sharing cache between the results. This currently is automatically setup with the React hooks, but subscription methods are exposed on the clients."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-typescript"},"const client = new FinchClient({\n  cache: new QueryCache(),\n});\n\nconst unsubscribe = client.subscribe(doc, variables, () => {\n  console.log('Ive got an update');\n});\n")),Object(o.b)("p",null,"The return of a subscribe method will be a function that will unsubscribe you from the updates to the cache key."),Object(o.b)("h2",{id:"react-hooks"},"React Hooks"),Object(o.b)("p",null,"Finch GraphQL comes packaged with React Hooks. This makes it super simple to start querying information from the graph from inside React Components."),Object(o.b)("h3",{id:"finchprovider"},"FinchProvider"),Object(o.b)("p",null,"The FinchClient can then be passed to the ",Object(o.b)("strong",{parentName:"p"},"FinchProvider")," when using the client with React. This makes the client available to all of the other hooks in this section."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-typescript"},"import { FinchProvider, FinchClient } from '@finch-graphql/react';\n\nconst client = new FinchClient();\n\nconst MyApp = () => {\n  return (\n    <FinchProvider client={client}>\n      {/* All your components go here */}\n    </FinchProvider>\n  );\n};\n")),Object(o.b)("h3",{id:"usequery"},"useQuery"),Object(o.b)("p",null,"This hook queries information when the component is rendered, and exposes a few pieces of data to allow you to control your component until the data is present."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-typescript"},"const { useQuery } from 'finch-graphql'\n\nconst MyComponent = () => {\n  const { data, loading, error } = useQuery(GetBrowserPermission, {\n    variables: { input: { permissions: ['geolocation'] } },\n  })\n\n  if (loading) {\n    // show loading state\n    return null\n  }\n\n  if (error) {\n    // show error state\n    return <>{error.message}</>\n  }\n\n  const hasPermission = data?.browser?.permissions;\n\n  // do stuff with data\n  return ...\n}\n")),Object(o.b)("p",null,"In the example above we are fetching the same data in the other example but in this example we are rendering a React component, and rendering different states based on the state of the API query."),Object(o.b)("h3",{id:"usemutation"},"useMutation"),Object(o.b)("p",null,"This hook allows for graphQL mutations sets up a mutation but then only will execute the mutation once a returned function is called."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-typescript"},"const { useMutation } from 'finch-graphql'\n\nconst MyComponent = () => {\n  const [requestPermissions, { data, error }] = useMutation(RequestPermissionsDoc);\n\n  const onClick = async () => {\n    await requestPermissions({ input: { permissions: ['geolocation'] });\n  }\n\n  return (\n    <>\n      {error ? <p>{error.message}</p> : null}\n      <button onClick={onClick}>Request Geolocation Permission</button>\n    </>\n  )\n}\n")),Object(o.b)("p",null,"In the above example we setup a mutation that is going to request a permission from the background script. If an error happens we will show it and we can also confirm that it was successful though the data parameter."))}u.isMDXComponent=!0},92:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var r=n(0),i=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=i.a.createContext({}),u=function(e){var t=i.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=u(e.components);return i.a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},b=i.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,a=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=u(n),b=r,m=p["".concat(a,".").concat(b)]||p[b]||h[b]||o;return n?i.a.createElement(m,s(s({ref:t},l),{},{components:n})):i.a.createElement(m,s({ref:t},l))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,a=new Array(o);a[0]=b;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var l=2;l<o;l++)a[l]=n[l];return i.a.createElement.apply(null,a)}return i.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);